<!DOCTYPE html>
<html>
<head>
    <title>Firebase Auth Test</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-functions.js"></script>
</head>
<body>
    <h1>Firebase Auth Test</h1>
    <div>
        <input type="email" id="email" placeholder="Email" value="test@example.com">
        <input type="password" id="password" placeholder="Password" value="testpassword123">
        <button onclick="signIn()">Sign In</button>
    </div>
    <div>
        <button onclick="getToken()">Get ID Token</button>
        <button onclick="testFunction()">Test removeWatermarkWithAI</button>
    </div>
    <div>
        <h3>ID Token:</h3>
        <textarea id="token" style="width:100%; height:100px;"></textarea>
    </div>
    <div>
        <h3>Result:</h3>
        <pre id="result"></pre>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js';
        import { getFunctions, httpsCallable } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-functions.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDoPA_WaSKW18QGvCnNNvXpL_G_kRtk46U",
            authDomain: "ai-watermark-backend-2024.firebaseapp.com",
            projectId: "ai-watermark-backend-2024",
            storageBucket: "ai-watermark-backend-2024.firebasestorage.app",
            messagingSenderId: "550066139623",
            appId: "1:550066139623:web:fa14b1be84dbe8a39f4d42"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const functions = getFunctions(app);

        window.signIn = async function() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                document.getElementById('result').textContent = 'Signed in: ' + userCredential.user.email;
            } catch (error) {
                document.getElementById('result').textContent = 'Error: ' + error.message;
            }
        };

        window.getToken = async function() {
            if (auth.currentUser) {
                const token = await auth.currentUser.getIdToken();
                document.getElementById('token').value = token;
                document.getElementById('result').textContent = 'Token generated!';
            } else {
                document.getElementById('result').textContent = 'Please sign in first';
            }
        };

        window.testFunction = async function() {
            if (auth.currentUser) {
                const removeWatermarkCallable = httpsCallable(functions, 'removeWatermarkWithAI');
                try {
                    const result = await removeWatermarkCallable({ 
                        parts: [{ text: "Test authenticated call" }] 
                    });
                    document.getElementById('result').textContent = 'Function result: ' + JSON.stringify(result.data, null, 2);
                } catch (error) {
                    document.getElementById('result').textContent = 'Function error: ' + error.message;
                }
            } else {
                document.getElementById('result').textContent = 'Please sign in first';
            }
        };
    </script>
</body>
</html>