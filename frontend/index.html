<!DOCTYPE html>
<html lang="en">
<head>
    <title>Free AI Watermark Remover Online - Professional Image Enhancement Tool 2025</title>
    <meta charset="utf-8" />
    <meta name="description" content="Professional AI watermark remover eliminates logos, text, timestamps from images instantly. Free online tool with enterprise-grade quality, zero quality loss. No signup required." />
    <meta name="keywords" content="watermark remover, AI watermark removal, remove watermarks, watermark elimination tool, free watermark remover, online image editor, logo remover, text overlay remover, professional image enhancement, batch watermark removal" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
    <meta name="author" content="WatermarkRemover.AI" />
    <meta name="generator" content="Professional AI Watermark Removal Technology" />
    <meta name="language" content="EN" />
    <meta name="theme-color" content="#4621ad" />
    
    <!-- Structured Data JSON-LD -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "AI Watermark Remover",
        "description": "Professional AI-powered watermark removal tool for images. Remove logos, text, timestamps instantly with zero quality loss.",
        "url": "https://watermarkremover.ai",
        "applicationCategory": "MultimediaApplication",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "featureList": [
            "AI-powered watermark detection",
            "Batch processing support",
            "High-quality image preservation",
            "Multiple file format support",
            "One-click watermark removal",
            "Privacy-focused processing"
        ],
        "screenshot": "https://watermarkremover.ai/og-image.jpg",
        "softwareVersion": "2.0",
        "dateModified": "2025-01-24",
        "provider": {
            "@type": "Organization",
            "name": "WatermarkRemover.AI",
            "url": "https://watermarkremover.ai"
        }
    }
    </script>
    
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="WatermarkRemover.AI" />
    <meta property="og:title" content="Professional AI Watermark Remover - Free Online Tool 2025" />
    <meta property="og:description" content="Transform images instantly with cutting-edge AI watermark removal. Eliminate logos, text overlays, timestamps with enterprise-grade precision. 100% free forever." />
    
    <link rel="canonical" href="https://watermarkremover.ai/" />
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🎨</text></svg>" />
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- FontAwesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #4621ad;
            --secondary-color: #313ed0;
            --accent-color: #973bfc;
            --text-dark: #1e1e2d;
            --text-gray: #7e8299;
            --border-color: #eff2f5;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background-color: #fff;
            overflow-x: hidden;
        }

        /* Header Navigation */
        .app-header {
            background: white;
            box-shadow: 0 0 50px 0 rgba(82, 63, 105, 0.15);
            position: sticky;
            top: 0;
            z-index: 1000;
            padding: 0;
        }

        .app-container {
            max-width: 1320px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .navbar-brand img {
            height: 40px;
            width: auto;
        }

        .navbar-nav .nav-link {
            color: var(--text-dark);
            font-weight: 500;
            padding: 0.75rem 1rem;
            transition: color 0.3s;
        }

        .navbar-nav .nav-link:hover {
            color: var(--primary-color);
        }

        /* Hero Section */
        .anime-header {
            background: linear-gradient(135deg, var(--secondary-color) 0%, var(--primary-color) 50%, var(--accent-color) 100%);
            color: white;
            padding: 80px 0 100px;
            position: relative;
            overflow: hidden;
        }

        .anime-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .hero-title {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 1.5rem;
            line-height: 1.2;
        }

        .hero-subtitle {
            font-size: 1.25rem;
            line-height: 2;
            margin: 2rem 0;
            opacity: 0.95;
        }

        .hero-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px 30px;
            border-radius: 50px;
            text-transform: uppercase;
            font-weight: 600;
            font-size: 0.875rem;
            text-decoration: none;
            transition: all 0.3s;
        }

        .hero-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            color: white;
            transform: translateY(-2px);
        }

        .hero-image {
            max-width: 75%;
            height: auto;
            border-radius: 15px;
        }

        /* Playground Section */
        .playground-section {
            padding: 80px 0;
            background: white;
        }

        .anime-section-header {
            text-align: center;
            margin-bottom: 4rem;
        }

        .anime-section-header h2 {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--text-dark);
            margin-bottom: 1rem;
        }

        .anime-section-header hr {
            width: 60px;
            height: 4px;
            background: var(--primary-color);
            border: none;
            margin: 2rem auto;
        }

        .anime-section-header .lead {
            font-size: 1.125rem;
            color: var(--text-gray);
            margin-bottom: 0;
        }

        /* Upload Area */
        .upload-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            padding: 3rem;
            border: 2px dashed var(--border-color);
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .upload-container:hover,
        .upload-container.dragover {
            border-color: var(--primary-color);
            background: rgba(70, 33, 173, 0.02);
            transform: translateY(-5px);
            box-shadow: 0 25px 80px rgba(70, 33, 173, 0.15);
        }

        .upload-icon {
            font-size: 4rem;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .upload-text {
            font-size: 1.25rem;
            color: var(--text-dark);
            margin-bottom: 1rem;
        }

        .upload-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-weight: 600;
            margin: 1rem 0;
            transition: all 0.3s;
        }

        .upload-btn:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }

        .supported-formats {
            color: var(--text-gray);
            font-size: 0.875rem;
            margin-top: 1rem;
        }

        .file-input {
            display: none;
        }

        /* Loading */
        .loading-section {
            display: none;
            text-align: center;
            padding: 3rem;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 2rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.125rem;
            color: var(--text-dark);
        }

        /* Result Section */
        .result-section {
            display: none;
            text-align: center;
            padding: 2rem 0;
        }

        .result-images {
            display: flex;
            gap: 2rem;
            justify-content: center;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .result-image-container {
            flex: 1;
            min-width: 300px;
            max-width: 400px;
        }

        .result-image-container h4 {
            margin-bottom: 1rem;
            color: var(--text-dark);
        }

        .result-image {
            width: 100%;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }

        .download-section {
            margin-top: 2rem;
        }

        .download-btn {
            background: #059669;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-weight: 600;
            margin: 0.5rem;
            transition: all 0.3s;
        }

        .download-btn:hover {
            background: #047857;
            transform: translateY(-2px);
        }

        .new-upload-btn {
            background: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            padding: 15px 30px;
            border-radius: 10px;
            font-weight: 600;
            margin: 0.5rem;
            transition: all 0.3s;
        }

        .new-upload-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        /* Features Section */
        .features-section {
            padding: 80px 0;
            background: #f8f9fa;
        }

        .feature-row {
            margin: 5rem 0;
        }

        .feature-content h4 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--text-dark);
        }

        .feature-content p {
            font-size: 1.125rem;
            color: var(--text-gray);
            font-weight: 500;
            line-height: 1.8;
        }

        .feature-content a {
            color: var(--primary-color);
            font-weight: 700;
            text-decoration: none;
            font-size: 1rem;
        }

        .feature-content a:hover {
            color: var(--secondary-color);
        }

        .feature-image {
            width: 100%;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }

        /* Advantages Section */
        .advantages-section {
            padding: 80px 0;
            background: white;
        }

        .advantages-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin-top: 3rem;
        }

        .advantage-card {
            background: white;
            padding: 2rem;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            text-align: center;
            transition: transform 0.3s;
        }

        .advantage-card:hover {
            transform: translateY(-10px);
        }

        .advantage-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            font-size: 2rem;
            color: white;
        }

        .advantage-card h5 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 1rem;
        }

        .advantage-card p {
            color: var(--text-gray);
            line-height: 1.6;
        }

        /* Final CTA Section */
        .final-cta {
            padding: 80px 0;
            background: linear-gradient(135deg, var(--secondary-color) 0%, var(--primary-color) 50%, var(--accent-color) 100%);
            color: white;
            text-align: center;
        }

        .final-cta h2 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
        }

        .final-cta p {
            font-size: 1.125rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .final-cta-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 15px 40px;
            border-radius: 10px;
            font-weight: 600;
            text-decoration: none;
            text-transform: uppercase;
            transition: all 0.3s;
        }

        .final-cta-btn:hover {
            background: white;
            color: var(--primary-color);
        }

        /* Footer */
        .footer {
            background: var(--text-dark);
            color: #7e8299;
            padding: 3rem 0 1rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .footer-section h6 {
            color: white;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .footer-section ul {
            list-style: none;
            padding: 0;
        }

        .footer-section ul li {
            margin-bottom: 0.5rem;
        }

        .footer-section ul li a {
            color: #7e8299;
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-section ul li a:hover {
            color: white;
        }

        .footer-bottom {
            border-top: 1px solid #2d2d41;
            padding-top: 2rem;
            text-align: center;
        }

        /* Error Message */
        .error-message {
            background: #fef2f2;
            color: #dc2626;
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            border-left: 4px solid #dc2626;
            display: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5rem;
            }
            
            .upload-container {
                margin: 0 1rem;
                padding: 2rem;
            }
            
            .result-images {
                flex-direction: column;
            }
            
            .result-image-container {
                min-width: unset;
                max-width: unset;
            }

            .advantages-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.6s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .success-message {
            background: #f0fdf4;
            color: #15803d;
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            border-left: 4px solid #15803d;
            display: none;
        }

        /* Before/After Slider Styles */
        .before-after-slider-container {
            max-width: 800px;
            margin: 3rem auto;
        }

        .before-after-slider {
            position: relative;
            width: 100%;
            height: 400px;
            overflow: hidden;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            cursor: ew-resize;
        }

        .demo-before-after .before-after-slider {
            height: 300px;
            max-width: 600px;
            margin: 0 auto;
        }

        .before-image-container,
        .after-image-container {
            position: absolute;
            top: 0;
            width: 100%;
            height: 100%;
        }

        .after-image-container {
            clip-path: inset(0 50% 0 0);
            transition: clip-path 0.3s ease;
        }

        .slider-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .image-label {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .demo-label {
            font-size: 0.75rem;
            padding: 6px 12px;
        }

        .after-image-container .image-label {
            left: auto;
            right: 20px;
            background: var(--primary-color);
        }

        .slider-handle {
            position: absolute;
            top: 0;
            left: 50%;
            width: 4px;
            height: 100%;
            background: white;
            transform: translateX(-50%);
            cursor: ew-resize;
            z-index: 10;
        }

        .slider-button {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 50px;
            height: 50px;
            background: white;
            border: 3px solid var(--primary-color);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            box-shadow: 0 8px 25px rgba(70, 33, 173, 0.3);
            transition: all 0.3s;
        }

        .demo-before-after .slider-button {
            width: 40px;
            height: 40px;
        }

        .slider-button:hover {
            background: var(--primary-color);
            color: white;
            transform: translate(-50%, -50%) scale(1.1);
        }

        /* Mode Selection Styles */
        .mode-tabs {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .mode-tab {
            background: white;
            border: 2px solid #e5e7eb;
            color: #6b7280;
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .mode-tab:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .mode-tab.active {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .pro-badge {
            background: #ff6b6b;
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 8px;
            font-weight: 700;
        }

        /* Manual Editor Styles */
        .manual-editor {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-top: 2rem;
        }

        .manual-editor.active {
            display: block;
        }

        .canvas-container {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            background: #f8f9fa;
        }

        .editing-canvas {
            max-width: 90vw;
            max-height: 70vh;
            min-width: 600px;
            min-height: 400px;
            cursor: crosshair;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        @media (max-width: 768px) {
            .editing-canvas {
                min-width: 300px;
                min-height: 200px;
                max-width: 95vw;
            }
        }

        .brush-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .brush-size {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .brush-size input[type="range"] {
            width: 100px;
        }

        .brush-size-display {
            width: 30px;
            height: 30px;
            border: 2px solid var(--primary-color);
            border-radius: 50%;
            background: rgba(70, 33, 173, 0.2);
        }

        .control-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .undo-btn {
            background: #f59e0b;
            color: white;
        }

        .clear-btn {
            background: #ef4444;
            color: white;
        }

        .process-btn {
            background: var(--primary-color);
            color: white;
        }

        .new-image-btn {
            background: #10b981;
            color: white;
        }

        .control-btn:hover {
            transform: translateY(-1px);
            opacity: 0.9;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .before-after-slider {
                height: 250px;
            }
            
            .demo-before-after .before-after-slider {
                height: 200px;
            }
            
            .slider-button {
                width: 40px;
                height: 40px;
            }
            
            .image-label {
                font-size: 0.75rem;
                padding: 6px 12px;
            }

            .mode-tabs {
                flex-direction: column;
                gap: 0.5rem;
            }

            .brush-controls {
                flex-direction: column;
                align-items: stretch;
            }

            .control-buttons {
                justify-content: center;
            }
        }

        /* FAQ Section Styles */
        .faq-section {
            padding: 80px 0;
            background: #f8f9fa;
        }

        .faq-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .faq-item {
            background: white;
            border-radius: 12px;
            margin-bottom: 1rem;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s;
        }

        .faq-item:hover {
            transform: translateY(-2px);
        }

        .faq-question {
            width: 100%;
            padding: 1.5rem;
            background: transparent;
            border: none;
            text-align: left;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-dark);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .faq-question:hover {
            background: #f8f9fa;
        }

        .faq-icon {
            font-size: 1.2rem;
            color: var(--primary-color);
            font-weight: bold;
            transition: transform 0.3s;
        }

        .faq-item.active .faq-icon {
            transform: rotate(45deg);
        }

        .faq-answer {
            padding: 0 1.5rem;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .faq-item.active .faq-answer {
            max-height: 300px;
            padding: 0 1.5rem 1.5rem;
        }

        .faq-answer div {
            color: #4b5563;
            line-height: 1.7;
            padding-top: 0.5rem;
        }
    </style>
</head>

<body>
    <!-- Header Navigation -->
    <div id="kt_app_header" class="app-header">
        <div class="app-container container-xxl d-flex align-items-stretch justify-content-between">
            <div class="d-flex align-items-center flex-grow-1 flex-xl-grow-0 me-xl-10">
                <a href="/">
                    <img alt="(Free, No Sign Up) AI Face Swap" src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='139' height='40' viewBox='0 0 139 40'><rect width='139' height='40' rx='8' fill='%234621ad'/><text x='70' y='28' text-anchor='middle' fill='white' font-family='Inter, sans-serif' font-weight='700' font-size='14'>🎨 WatermarkRemover</text></svg>" class="h-35px h-sm-40px w-auto" width="139" height="40" />
                </a>
            </div>
            
            <nav class="navbar navbar-expand-xl">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" href="/">Face Swap</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/video-face-swap-ai/">Video Face Swap</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#feature">Face Swappers</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#advantages">AI Video</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#final-cta">AI Image</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#tools">AI Tools</a>
                        </li>
                    </ul>
                    
                    <!-- Auth Buttons -->
                    <div class="auth-buttons ms-3">
                        <button class="btn btn-outline-primary me-2" id="loginBtn" onclick="showLogin()">
                            <i class="fas fa-sign-in-alt"></i> Sign In
                        </button>
                        <button class="btn btn-primary" id="registerBtn" onclick="showRegister()">
                            <i class="fas fa-user-plus"></i> Sign Up
                        </button>
                        
                        <!-- User Menu (hidden by default) -->
                        <div class="dropdown" id="userMenu" style="display: none;">
                            <button class="btn btn-success dropdown-toggle d-flex align-items-center" type="button" data-bs-toggle="dropdown" style="background: linear-gradient(135deg, #10b981, #059669); border: none; box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3); min-width: 160px;">
                                <i class="fas fa-user-circle me-2"></i> 
                                <div class="d-flex flex-column align-items-start">
                                    <span id="userName" style="font-weight: 600; font-size: 0.9rem;">User</span>
                                    <small id="userTokens" style="font-size: 0.7rem; opacity: 0.9;">🪙 3 tokens</small>
                                </div>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end" style="min-width: 280px;">
                                <li class="dropdown-header">
                                    <div class="text-center">
                                        <i class="fas fa-user-circle fa-2x text-primary mb-2"></i>
                                        <div class="fw-bold" id="dropdownUserName">User Name</div>
                                        <small class="text-muted" id="dropdownUserEmail">user@example.com</small>
                                    </div>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                
                                <!-- Token Balance -->
                                <li>
                                    <div class="dropdown-item-text bg-light rounded mx-2 p-3 mb-2">
                                        <div class="text-center">
                                            <h5 class="mb-1"><i class="fas fa-coins text-warning"></i> <span id="headerTokenBalance">3</span> Tokens</h5>
                                            <small class="text-muted">1 token = 1 photo removal</small>
                                            <div class="progress mt-2" style="height: 6px;">
                                                <div class="progress-bar bg-warning" id="tokenProgress" role="progressbar" style="width: 100%"></div>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                                
                                <li>
                                    <div class="dropdown-item-text">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span><i class="fas fa-images text-primary"></i> Images processed:</span>
                                            <strong id="headerProcessedCount">0</strong>
                                        </div>
                                    </div>
                                </li>
                                <li>
                                    <div class="dropdown-item-text">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span><i class="fas fa-crown text-warning"></i> Plan:</span>
                                            <span id="headerSubscriptionStatus" class="badge bg-success">Free</span>
                                        </div>
                                    </div>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" onclick="showProfile()">
                                    <i class="fas fa-user text-primary"></i> Profile Settings
                                </a></li>
                                <li><a class="dropdown-item" href="#" onclick="showSubscription()">
                                    <i class="fas fa-crown text-warning"></i> Buy More Tokens
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-danger" href="#" onclick="logout()">
                                    <i class="fas fa-sign-out-alt"></i> Sign Out
                                </a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
    </div>

    <!-- Main Content -->
    <div class="app-wrapper flex-column flex-row-fluid">
        <div class="app-main flex-column flex-row-fluid">
            <div class="d-flex flex-column flex-column-fluid">
                <div class="app-content flex-column-fluid pt-0">
                    
                    <!-- Hero Section -->
                    <header class="anime-header">
                        <div class="anime-container">
                            <div class="row align-items-center">
                                <div class="col-lg-6">
                                    <h1 class="hero-title">
                                        Professional AI Watermark Remover Online
                                    </h1>
                                    <p class="hero-subtitle">
                                        Transform your images instantly with cutting-edge artificial intelligence technology. Eliminate watermarks, logos, and text overlays without quality loss in seconds.<br>
                                        —Enterprise-grade results, zero cost, maximum privacy guaranteed!
                                    </p>
                                    <div class="d-flex gap-3 justify-content-center justify-content-lg-start my-5">
                                        <a class="hero-btn" href="#app-playground">remove watermark now</a>
                                    </div>
                                </div>
                                <div class="col-lg-6 text-center p-4">
                                    <img class="hero-image" width="400" height="400" src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='400' height='400' viewBox='0 0 400 400'><rect width='400' height='400' rx='15' fill='%23f8f9fa'/><circle cx='200' cy='150' r='50' fill='%234621ad'/><rect x='150' y='250' width='100' height='20' rx='10' fill='%23e5e7eb'/><rect x='120' y='290' width='160' height='20' rx='10' fill='%23e5e7eb'/><text x='200' y='350' text-anchor='middle' fill='%234621ad' font-size='16' font-weight='600'>AI Watermark Remover</text></svg>" alt="AI watermark remover" />
                                </div>
                            </div>
                        </div>
                    </header>

                    <!-- Playground Section -->
                    <section class="playground-section" id="app-playground">
                        <header class="anime-section-header">
                            <h2>AI Watermark Elimination in One Click</h2>
                            <hr />
                            <p class="lead">Transform your images instantly with cutting-edge AI technology. Eliminate unwanted watermarks, logos, and text overlays in seconds with professional-grade results 👇👇👇</p>
                        </header>
                        
                        <div class="anime-container">
                            <div class="row align-items-center">
                                <!-- Demo Before/After Slider -->
                                <div class="col-lg-6 mb-4">
                                    <div class="demo-before-after">
                                        <div class="before-after-slider" id="demoSlider">
                                            <div class="before-image-container">
                                                <img src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='500' height='300' viewBox='0 0 500 300'><defs><pattern id='demoWatermark' patternUnits='userSpaceOnUse' width='80' height='80' patternTransform='rotate(-30)'><text x='40' y='40' text-anchor='middle' fill='rgba(0,0,0,0.2)' font-size='12' font-weight='bold'>SAMPLE</text></pattern></defs><rect width='500' height='300' fill='%23f0f9ff'/><rect width='500' height='300' fill='url(%23demoWatermark)'/><circle cx='150' cy='100' r='40' fill='%236366f1'/><rect x='250' y='50' width='200' height='30' rx='15' fill='%236366f1'/><rect x='250' y='100' width='150' height='20' rx='10' fill='%239ca3af'/><rect x='250' y='130' width='180' height='20' rx='10' fill='%239ca3af'/><text x='250' y='200' fill='%234b5563' font-size='14'>Demo image with watermarks</text><rect x='50' y='250' width='100' height='30' rx='5' fill='rgba(239,68,68,0.8)'/><text x='100' y='270' text-anchor='middle' fill='white' font-size='12' font-weight='bold'>LOGO</text></svg>" alt="Demo image with watermarks" class="slider-image">
                                                <div class="image-label demo-label">ORIGINAL</div>
                                            </div>
                                            <div class="after-image-container">
                                                <img src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='500' height='300' viewBox='0 0 500 300'><rect width='500' height='300' fill='%23f0f9ff'/><circle cx='150' cy='100' r='40' fill='%236366f1'/><rect x='250' y='50' width='200' height='30' rx='15' fill='%236366f1'/><rect x='250' y='100' width='150' height='20' rx='10' fill='%239ca3af'/><rect x='250' y='130' width='180' height='20' rx='10' fill='%239ca3af'/><text x='250' y='200' fill='%234b5563' font-size='14'>Clean professional image</text><circle cx='450' cy='50' r='15' fill='%2310b981'/><text x='450' y='57' text-anchor='middle' fill='white' font-size='10' font-weight='bold'>✓</text></svg>" alt="Clean demo image" class="slider-image">
                                                <div class="image-label demo-label">AI PROCESSED</div>
                                            </div>
                                            <div class="slider-handle" id="demoSliderHandle">
                                                <div class="slider-button">
                                                    <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                                        <path d="M8 4l4 6-4 6V4z"/>
                                                    </svg>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Upload Area -->
                                <div class="col-lg-6 mb-4">
                                    <!-- Mode Selection -->
                                    <div class="mode-selection" style="margin-bottom: 2rem;">
                                        <div class="mode-tabs">
                                            <button class="mode-tab active" id="autoMode" onclick="selectMode('auto')">
                                                <i class="fas fa-magic"></i> Auto Removal
                                            </button>
                                            <button class="mode-tab" id="manualMode" onclick="selectMode('manual')">
                                                <i class="fas fa-paint-brush"></i> Manual Pro <span class="pro-badge">PRO</span>
                                            </button>
                                        </div>
                                    </div>

                                    <div class="upload-container" onclick="document.getElementById('fileInput').click()">
                                        <div class="upload-icon">📤</div>
                                        <div class="upload-text" id="uploadText">
                                            For more precise results, use edit mode.
                                        </div>
                                        <button class="upload-btn">drag an image (≤20M)</button>
                                        <div class="supported-formats">support formats: png/jpeg/webp/bmp</div>
                                        <input type="file" id="fileInput" class="file-input" accept="image/png,image/jpeg,image/webp,image/bmp">
                                    </div>
                                </div>
                            </div>
                            <!-- Loading Section -->
                            <div id="loadingSection" class="loading-section">
                                <div class="spinner"></div>
                                <div class="loading-text">AI is processing your image...<br>Please wait while we remove the watermark</div>
                            </div>

                            <!-- Manual Editor Pro -->
                            <div id="manualEditor" class="manual-editor">
                                <h3 style="text-align: center; margin-bottom: 2rem; color: var(--text-dark);">
                                    <i class="fas fa-paint-brush" style="color: var(--primary-color);"></i> Manual Pro Editor
                                </h3>
                                
                                <div class="brush-controls">
                                    <div class="brush-size">
                                        <label>Brush Size:</label>
                                        <input type="range" id="brushSize" min="5" max="50" value="20">
                                        <div class="brush-size-display" id="brushDisplay"></div>
                                    </div>
                                    
                                    <div class="control-buttons">
                                        <button class="control-btn undo-btn" id="undoBtn">
                                            <i class="fas fa-undo"></i> Undo
                                        </button>
                                        <button class="control-btn clear-btn" id="clearBtn">
                                            <i class="fas fa-eraser"></i> Clear All
                                        </button>
                        <button class="control-btn process-btn" id="processManualBtn">
                            <i class="fas fa-sparkles"></i> Generate Clean Image
                        </button>
                                        <button class="control-btn new-image-btn" id="newImageBtn">
                                            <i class="fas fa-plus"></i> New Image
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="canvas-container" id="canvasContainer">
                                    <canvas id="editingCanvas" class="editing-canvas"></canvas>
                                </div>
                                
                                <!-- Manual Editor Loading -->
                                <div id="manualLoading" class="loading-section" style="display: none; background: white; margin: 2rem 0;">
                                    <div class="spinner"></div>
                                    <div class="loading-text">AI is processing marked areas...<br>Please wait while we remove selected watermarks</div>
                                </div>
                                
                                <!-- Manual Editor Result -->
                                <div id="manualResult" class="result-section" style="display: none; background: white; margin: 2rem 0; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
                                    <h3 style="text-align: center; margin-bottom: 2rem; color: var(--text-dark);">
                                        <i class="fas fa-magic" style="color: #10b981;"></i> Manual Editing Complete!
                                    </h3>
                                    <div class="result-images">
                                        <div class="result-image-container">
                                            <h4>Original Image</h4>
                                            <img id="manualOriginalImage" class="result-image" alt="Original image">
                                        </div>
                                        <div class="result-image-container">
                                            <h4>Edited Result</h4>
                                            <img id="manualProcessedImage" class="result-image" alt="Processed image">
                                        </div>
                                    </div>
                                    <div class="download-section">
                                        <button id="manualDownloadBtn" class="download-btn">
                                            <i class="fas fa-download"></i> Download High Quality
                                        </button>
                                        <button id="shareBtn" class="control-btn" style="background: #1da1f2; color: white; margin-left: 0.5rem;">
                                            <i class="fas fa-share-alt"></i> Download & Share
                                        </button>
                                        <button class="new-image-btn" onclick="resetManualEditor()" style="margin-left: 0.5rem;">
                                            <i class="fas fa-plus"></i> Edit New Image
                                        </button>
                                    </div>
                                </div>
                                
                                <div style="text-align: center; margin-top: 1rem; color: #6b7280; font-size: 0.9rem;" id="instructionText">
                                    <i class="fas fa-info-circle"></i> Paint over watermarks and unwanted areas, then click "Remove Selected Areas"
                                </div>
                            </div>

                            <!-- Error Message -->
                            <div id="errorMessage" class="error-message"></div>
                            
                            <!-- Success Message -->
                            <div id="successMessage" class="success-message"></div>

                            <!-- Result Section -->
                            <div id="resultSection" class="result-section">
                                <h3>🎉 Watermark Successfully Removed!</h3>
                                <div class="result-images">
                                    <div class="result-image-container">
                                        <h4>Original Image</h4>
                                        <img id="originalImage" class="result-image" alt="Original image">
                                    </div>
                                    <div class="result-image-container">
                                        <h4>Result</h4>
                                        <img id="processedImage" class="result-image" alt="Processed image">
                                    </div>
                                </div>
                                <div class="download-section">
                                    <button id="downloadBtn" class="download-btn">
                                        <i class="fas fa-download"></i> Download High Quality Image
                                    </button>
                                    <button id="mainShareBtn" class="control-btn" style="background: #1da1f2; color: white; margin-left: 0.5rem;">
                                        <i class="fas fa-share-alt"></i> Download & Share
                                    </button>
                                    <button class="new-upload-btn" onclick="resetUpload()" style="margin-left: 0.5rem;">
                                        <i class="fas fa-redo"></i> Upload Another Image
                                    </button>
                                </div>
                            </div>
                        </section>

                    <!-- Features Section -->
                    <section class="features-section" id="feature">
                        <header class="anime-section-header">
                            <small style="color: #7e8299; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;">FEATURE</small>
                            <h2>What are the Features of Our AI Watermark Remover?</h2>
                        </header>
                        
                        <div class="anime-container">
                            <!-- Feature 1 -->
                            <div class="row feature-row align-items-center">
                                <div class="col-md-6">
                                    <div class="feature-content">
                                        <h4>Advanced Multi-Shape Watermark Detection</h4>
                                        <p>Our cutting-edge AI excels at eliminating watermarks of any complexity—from simple text overlays and basic logos to intricate multi-layered patterns covering entire image sections. Revolutionary computer vision algorithms analyze contextual pixel relationships, intelligently reconstructing obscured areas while preserving original artistic integrity. Perfect for photographers, designers, content creators, and businesses requiring professional-grade watermark removal across diverse image types and watermark configurations.</p>
                                        <br>
                                        <a href="#app-playground">Try AI Watermark Remover for Free >></a>
                                    </div>
                                </div>
                                <div class="col-md-5 order-md-first">
                                    <img class="feature-image" width="264" height="264" src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='264' height='264' viewBox='0 0 264 264'><rect width='264' height='264' rx='15' fill='%23f8f9fa'/><rect x='50' y='50' width='164' height='164' rx='10' fill='%234621ad' opacity='0.1'/><circle cx='132' cy='100' r='20' fill='%234621ad'/><rect x='90' y='140' width='84' height='8' rx='4' fill='%234621ad' opacity='0.6'/><rect x='70' y='160' width='124' height='8' rx='4' fill='%234621ad' opacity='0.4'/><text x='132' y='200' text-anchor='middle' fill='%234621ad' font-size='12' font-weight='600'>Different Shapes</text></svg>" alt="remove watermark of different shapes" />
                                </div>
                            </div>

                            <!-- Feature 2 -->
                            <div class="row feature-row align-items-center">
                                <div class="col-md-6">
                                    <div class="feature-content">
                                        <h4>Intelligent Auto-Detection Technology</h4>
                                        <p>Experience the future of image processing with our breakthrough one-click automatic mode. Advanced machine learning models instantly identify and eliminate watermarks without user intervention, applying optimal removal strategies based on watermark type, positioning, and background complexity. Ideal for high-volume processing, content creators, and professionals who demand efficiency without compromising quality. Simply upload and watch AI magic transform your images in seconds.</p>
                                        <br>
                                        <a href="#app-playground">Experience the Automatic Mode of AI Watermark Remover >></a>
                                    </div>
                                </div>
                                <div class="col-md-5">
                                    <img class="feature-image" width="264" height="264" src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='264' height='264' viewBox='0 0 264 264'><rect width='264' height='264' rx='15' fill='%23f8f9fa'/><rect x='50' y='50' width='164' height='164' rx='10' fill='%2359c9a5' opacity='0.1'/><circle cx='132' cy='132' r='40' fill='%2359c9a5'/><text x='132' y='140' text-anchor='middle' fill='white' font-size='20' font-weight='700'>1</text><text x='132' y='200' text-anchor='middle' fill='%2359c9a5' font-size='12' font-weight='600'>One Click</text></svg>" alt="one-click watermark remover" />
                                </div>
                            </div>

                            <!-- Feature 3 -->
                            <div class="row feature-row align-items-center">
                                <div class="col-md-6">
                                    <div class="feature-content">
                                        <h4>Precision Manual Selection Mode</h4>
                                        <p>Achieve surgical precision with our advanced manual selection technology. Perfect for complex watermarks intertwined with critical image elements or irregular patterns requiring expert attention. Simply select target areas and watch our AI perform pixel-perfect reconstruction while preserving surrounding detail integrity. Essential for professional photographers, graphic designers, and image restoration specialists who demand absolute control and flawless results in challenging watermark removal scenarios.</p>
                                        <br>
                                        <a href="#app-playground">Precisely Remove Watermarks from Images >></a>
                                    </div>
                                </div>
                                <div class="col-md-5 order-md-first">
                                    <img class="feature-image" width="264" height="264" src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='264' height='264' viewBox='0 0 264 264'><rect width='264' height='264' rx='15' fill='%23f8f9fa'/><rect x='50' y='50' width='164' height='164' rx='10' fill='%23f59e0b' opacity='0.1'/><rect x='70' y='70' width='124' height='124' rx='8' fill='none' stroke='%23f59e0b' stroke-width='2' stroke-dasharray='5,5'/><circle cx='90' cy='90' r='6' fill='%23f59e0b'/><circle cx='174' cy='90' r='6' fill='%23f59e0b'/><circle cx='90' cy='174' r='6' fill='%23f59e0b'/><circle cx='174' cy='174' r='6' fill='%23f59e0b'/><text x='132' y='210' text-anchor='middle' fill='%23f59e0b' font-size='12' font-weight='600'>Manual Selection</text></svg>" alt="Select area and remove watermark" />
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Advantages Section -->
                    <section class="advantages-section" id="advantages">
                        <header class="anime-section-header">
                            <h2>Revolutionary AI Watermark Removal Technology</h2>
                            <p class="lead">Experience the power of advanced artificial intelligence with our industry-leading watermark removal solution featuring 6 breakthrough advantages.</p>
                            
                            <!-- Before/After Slider -->
                            <div class="before-after-slider-container">
                                <div class="before-after-slider" id="advantagesSlider">
                                    <div class="before-image-container">
                                        <img src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='600' height='400' viewBox='0 0 600 400'><defs><pattern id='watermark' patternUnits='userSpaceOnUse' width='100' height='100' patternTransform='rotate(45)'><text x='50' y='50' text-anchor='middle' fill='rgba(255,255,255,0.3)' font-size='14' font-weight='bold'>WATERMARK</text></pattern></defs><rect width='600' height='400' fill='%234f46e5'/><rect width='600' height='400' fill='url(%23watermark)'/><rect x='50' y='50' width='500' height='100' rx='10' fill='rgba(255,255,255,0.1)'/><text x='300' y='120' text-anchor='middle' fill='white' font-size='24' font-weight='700'>Original Image with Watermarks</text><text x='300' y='200' text-anchor='middle' fill='rgba(255,255,255,0.8)' font-size='16'>Multiple watermarks and logos</text><text x='300' y='230' text-anchor='middle' fill='rgba(255,255,255,0.8)' font-size='16'>covering important content</text></svg>" alt="Image with watermarks" class="slider-image">
                                        <div class="image-label">BEFORE</div>
                                    </div>
                                    <div class="after-image-container">
                                        <img src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' width='600' height='400' viewBox='0 0 600 400'><rect width='600' height='400' fill='%234f46e5'/><rect x='50' y='50' width='500' height='100' rx='10' fill='rgba(255,255,255,0.1)'/><text x='300' y='120' text-anchor='middle' fill='white' font-size='24' font-weight='700'>Clean Professional Image</text><text x='300' y='200' text-anchor='middle' fill='rgba(255,255,255,0.8)' font-size='16'>All watermarks completely removed</text><text x='300' y='230' text-anchor='middle' fill='rgba(255,255,255,0.8)' font-size='16'>with perfect quality preservation</text><circle cx='550' cy='50' r='20' fill='%2310b981'/><text x='550' y='58' text-anchor='middle' fill='white' font-size='16' font-weight='bold'>✓</text></svg>" alt="Clean image without watermarks" class="slider-image">
                                        <div class="image-label">AFTER</div>
                                    </div>
                                    <div class="slider-handle" id="advantagesSliderHandle">
                                        <div class="slider-button">
                                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 20 20">
                                                <path d="M8 4l4 6-4 6V4z"/>
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </header>
                        
                        <div class="anime-container">
                            <div class="advantages-grid">
                                <div class="advantage-card">
                                    <div class="advantage-icon">🎯</div>
                                    <h5>Dual-Mode AI Technology</h5>
                                    <p>Experience unparalleled versatility with our intelligent dual-mode system: lightning-fast automatic detection for instant results, plus precision manual selection for complex watermark patterns requiring surgical accuracy.</p>
                                </div>
                                
                                <div class="advantage-card">
                                    <div class="advantage-icon">⚡</div>
                                    <h5>One-Click Simplicity</h5>
                                    <p>Revolutionary user experience designed for professionals and beginners alike. Transform watermarked images into pristine masterpieces with just one click—no technical expertise required.</p>
                                </div>
                                
                                <div class="advantage-card">
                                    <div class="advantage-icon">⭐</div>
                                    <h5>Enterprise-Grade Quality</h5>
                                    <p>Advanced neural networks and machine learning algorithms preserve original image integrity while eliminating watermarks with pixel-perfect precision, delivering studio-quality results every time.</p>
                                </div>
                                
                                <div class="advantage-card">
                                    <div class="advantage-icon">🚀</div>
                                    <h5>Lightning Processing Speed</h5>
                                    <p>State-of-the-art optimization delivers professional results in seconds, not minutes. Process hundreds of images efficiently with our high-performance AI infrastructure designed for maximum throughput.</p>
                                </div>
                                
                                <div class="advantage-card">
                                    <div class="advantage-icon">💎</div>
                                    <h5>Completely Free Forever</h5>
                                    <p>Premium AI watermark removal technology accessible to everyone. No hidden fees, no subscription traps, no usage limits—just powerful image enhancement tools available 24/7 at zero cost.</p>
                                </div>
                                
                                <div class="advantage-card">
                                    <div class="advantage-icon">🔒</div>
                                    <h5>Military-Grade Privacy</h5>
                                    <p>Your images never leave your device during processing. End-to-end encryption, zero data retention, and complete privacy protection ensure your sensitive content remains absolutely confidential.</p>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- FAQ Section -->
                    <section class="faq-section" id="faq">
                        <div class="anime-container">
                            <header class="anime-section-header">
                                <h2>Frequently Asked Questions</h2>
                                <p class="lead">Everything you need to know about our AI watermark removal technology</p>
                            </header>
                            
                            <div class="faq-container">
                                <div class="faq-item" itemscope itemtype="https://schema.org/Question">
                                    <button class="faq-question" itemprop="name">
                                        How much does it cost to remove watermarks from one photo?
                                        <span class="faq-icon">+</span>
                                    </button>
                                    <div class="faq-answer" itemscope itemtype="https://schema.org/Answer">
                                        <div itemprop="text">
                                            <strong>🎉 Start with 3 FREE tokens!</strong> Each photo removal costs <strong>1 token</strong>. You get <strong>3 free tokens</strong> to test our AI technology - no credit card required, no signup needed.<br><br>
                                            💰 <strong>Token Pricing:</strong><br>
                                            • <strong>Free Plan:</strong> 3 tokens (3 photos) - $0<br>
                                            • <strong>Pro Monthly:</strong> Unlimited tokens - $9.99/month<br>
                                            • <strong>Pro Yearly:</strong> Unlimited tokens - $99.99/year (Save 17%)<br><br>
                                            🚀 Perfect for testing our enterprise-grade quality before upgrading!
                                        </div>
                                    </div>
                                </div>

                                <div class="faq-item" itemscope itemtype="https://schema.org/Question">
                                    <button class="faq-question" itemprop="name">
                                        How do tokens work and what do I get with each plan?
                                        <span class="faq-icon">+</span>
                                    </button>
                                    <div class="faq-answer" itemscope itemtype="https://schema.org/Answer">
                                        <div itemprop="text">
                                            <strong>🪙 Token System Explained:</strong><br>
                                            • <strong>1 Token = 1 Photo Removal</strong> (any size, any complexity)<br>
                                            • <strong>Free Account:</strong> 3 tokens (refreshes daily)<br>
                                            • <strong>Pro Monthly:</strong> Unlimited tokens + Manual Pro mode<br>
                                            • <strong>Pro Yearly:</strong> Everything + 17% savings + priority support<br><br>
                                            ✨ <strong>Pro Benefits:</strong> Manual brush tool, unlimited processing, HD quality, priority processing, email support, and early access to new features.
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="faq-item" itemscope itemtype="https://schema.org/Question">
                                    <button class="faq-question" itemprop="name">
                                        What types of watermarks can your AI remove?
                                        <span class="faq-icon">+</span>
                                    </button>
                                    <div class="faq-answer" itemscope itemtype="https://schema.org/Answer">
                                        <div itemprop="text">
                                            Our advanced AI can eliminate virtually any watermark type: text overlays, logos, timestamps, signatures, copyright marks, semi-transparent patterns, complex multi-layered watermarks, and even challenging watermarks that cover large image areas. The technology works on both simple and intricate watermark designs.
                                        </div>
                                    </div>
                                </div>

                                <div class="faq-item" itemscope itemtype="https://schema.org/Question">
                                    <button class="faq-question" itemprop="name">
                                        Will my image quality be affected after watermark removal?
                                        <span class="faq-icon">+</span>
                                    </button>
                                    <div class="faq-answer" itemscope itemtype="https://schema.org/Answer">
                                        <div itemprop="text">
                                            No quality loss guaranteed! Our enterprise-grade AI uses advanced neural networks to preserve original image integrity while reconstructing watermarked areas with pixel-perfect precision. The result is a clean, professional image that maintains the original resolution, colors, and details.
                                        </div>
                                    </div>
                                </div>

                                <div class="faq-item" itemscope itemtype="https://schema.org/Question">
                                    <button class="faq-question" itemprop="name">
                                        How long does the watermark removal process take?
                                        <span class="faq-icon">+</span>
                                    </button>
                                    <div class="faq-answer" itemscope itemtype="https://schema.org/Answer">
                                        <div itemprop="text">
                                            Lightning-fast processing! Most images are processed in 10-30 seconds depending on file size and watermark complexity. Our optimized AI infrastructure ensures rapid results without compromising quality. Large or complex images may take up to 60 seconds for optimal results.
                                        </div>
                                    </div>
                                </div>

                                <div class="faq-item" itemscope itemtype="https://schema.org/Question">
                                    <button class="faq-question" itemprop="name">
                                        Is my data safe and private when using your service?
                                        <span class="faq-icon">+</span>
                                    </button>
                                    <div class="faq-answer" itemscope itemtype="https://schema.org/Answer">
                                        <div itemprop="text">
                                            Absolutely secure! We implement military-grade privacy protection. Your images are processed with end-to-end encryption, never stored on our servers, and automatically deleted after processing. Zero data retention policy ensures complete confidentiality for sensitive content.
                                        </div>
                                    </div>
                                </div>

                                <div class="faq-item" itemscope itemtype="https://schema.org/Question">
                                    <button class="faq-question" itemprop="name">
                                        What file formats are supported?
                                        <span class="faq-icon">+</span>
                                    </button>
                                    <div class="faq-answer" itemscope itemtype="https://schema.org/Answer">
                                        <div itemprop="text">
                                            We support all major image formats: JPEG, PNG, WEBP, and BMP. Maximum file size is 20MB to ensure optimal processing speed. The output maintains the original format or can be converted to your preferred format for maximum compatibility.
                                        </div>
                                    </div>
                                </div>

                                <div class="faq-item" itemscope itemtype="https://schema.org/Question">
                                    <button class="faq-question" itemprop="name">
                                        Do I need to create an account or sign up?
                                        <span class="faq-icon">+</span>
                                    </button>
                                    <div class="faq-answer" itemscope itemtype="https://schema.org/Answer">
                                        <div itemprop="text">
                                            No signup required! Start removing watermarks immediately with our 3 free trial images. Simply upload your image and let our AI work its magic. For unlimited access, our Pro version offers seamless processing without any registration hassles.
                                        </div>
                                    </div>
                                </div>

                                <div class="faq-item" itemscope itemtype="https://schema.org/Question">
                                    <button class="faq-question" itemprop="name">
                                        What's the difference between Auto and Manual Pro modes?
                                        <span class="faq-icon">+</span>
                                    </button>
                                    <div class="faq-answer" itemscope itemtype="https://schema.org/Answer">
                                        <div itemprop="text">
                                            <strong>Auto Mode:</strong> One-click intelligent detection removes watermarks automatically - perfect for most images.<br><br>
                                            <strong>Manual Pro Mode:</strong> Precision control with brush tool lets you select exactly which areas to remove - ideal for complex watermarks or when you need surgical precision. Pro mode includes advanced editing tools and unlimited processing.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Final CTA Section -->
                    <section class="final-cta" id="final-cta">
                        <div class="anime-container">
                            <h2>Ultimate Watermark Elimination Solution</h2>
                            <p>Experience the most advanced AI-powered watermark removal technology available today. Instantly eliminate text overlays, logos, timestamps, signatures, and complex watermark patterns from any image format with professional-grade precision and zero quality compromise.</p>
                            <a href="#app-playground" class="final-cta-btn">Start Professional Enhancement Now</a>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer" id="tools">
        <div class="anime-container">
            <div class="footer-content">
                <div class="footer-section">
                    <h6>Product</h6>
                    <ul>
                        <li><a href="/">Face Swap</a></li>
                        <li><a href="/multiple-face-swap">Multiple Face Swap</a></li>
                        <li><a href="/video-face-swap-ai/">Video Face Swap</a></li>
                        <li><a href="/gif-face-swap">Gif Face Swap</a></li>
                        <li><a href="/batch-face-swap">Batch Face Swap</a></li>
                        <li><a href="/ai-attractiveness-test">AI Attractiveness Test</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h6>Information</h6>
                    <ul>
                        <li><a href="/terms-of-service">Terms of Service</a></li>
                        <li><a href="/privacy-policy">Privacy Policy</a></li>
                        <li><a href="/ai-solution">AI Solution</a></li>
                        <li><a href="/features">Features</a></li>
                        <li><a href="/api-service">API Service</a></li>
                        <li><a href="/contact-us">Contact Us</a></li>
                        <li><a href="/refund-policy">Refund Policy</a></li>
                        <li><a href="/content-policy">Content Policy</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h6>Contact</h6>
                    <p>Free yourself with AI face swap. Enjoy endless creative fun.</p>
                    <p>Email: service@watermarkremover.ai</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; WATERMARK REMOVER AI 2025, All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Modal Windows -->
    
    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title">
                        <i class="fas fa-sign-in-alt text-primary"></i> Welcome Back
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label class="form-label">Email Address</label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="fas fa-envelope"></i>
                                </span>
                                <input type="email" class="form-control" id="loginEmail" required>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="form-label">Password</label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="fas fa-lock"></i>
                                </span>
                                <input type="password" class="form-control" id="loginPassword" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary w-100 mb-3">
                            <i class="fas fa-sign-in-alt"></i> Sign In
                        </button>
                    </form>
                    
                    <div class="text-center">
                        <div class="mb-3">
                            <small class="text-muted">Don't have an account?</small>
                            <a href="#" onclick="switchToRegister()" class="text-decoration-none">Sign up here</a>
                        </div>
                        
                        <div class="text-center">
                            <small class="text-muted">or</small>
                        </div>
                        
                        <button class="btn btn-outline-danger w-100 mt-3" onclick="signInWithGoogle()">
                            <i class="fab fa-google"></i> Continue with Google
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div class="modal fade" id="registerModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title">
                        <i class="fas fa-user-plus text-primary"></i> Create Account
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="registerForm">
                        <div class="mb-3">
                            <label class="form-label">Full Name</label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="fas fa-user"></i>
                                </span>
                                <input type="text" class="form-control" id="registerName" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email Address</label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="fas fa-envelope"></i>
                                </span>
                                <input type="email" class="form-control" id="registerEmail" required>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="form-label">Password</label>
                            <div class="input-group">
                                <span class="input-group-text">
                                    <i class="fas fa-lock"></i>
                                </span>
                                <input type="password" class="form-control" id="registerPassword" required minlength="6">
                            </div>
                            <small class="text-muted">Minimum 6 characters</small>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="agreeTerms" required>
                                <label class="form-check-label" for="agreeTerms">
                                    I agree to the <a href="/terms" target="_blank">Terms of Service</a> and <a href="/privacy" target="_blank">Privacy Policy</a>
                                </label>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100 mb-3">
                            <i class="fas fa-user-plus"></i> Create Account
                        </button>
                    </form>
                    
                    <div class="text-center">
                        <div class="mb-3">
                            <small class="text-muted">Already have an account?</small>
                            <a href="#" onclick="switchToLogin()" class="text-decoration-none">Sign in here</a>
                        </div>
                        
                        <div class="text-center">
                            <small class="text-muted">or</small>
                        </div>
                        
                        <button class="btn btn-outline-danger w-100 mt-3" onclick="signUpWithGoogle()">
                            <i class="fab fa-google"></i> Sign up with Google
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Subscription Modal -->
    <div class="modal fade" id="subscriptionModal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title">
                        <i class="fas fa-crown text-warning"></i> Upgrade to Pro
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="text-center mb-4">
                        <h3>Choose Your Plan</h3>
                        <p class="text-muted">Unlock unlimited watermark removal and premium features</p>
                    </div>
                    
                    <div class="row g-3">
                        <!-- Free Plan -->
                        <div class="col-md-4">
                            <div class="card h-100 border-2">
                                <div class="card-body text-center p-4">
                                    <div class="plan-icon mb-3">
                                        <i class="fas fa-gift fa-3x text-success"></i>
                                    </div>
                                    <h5>Free Plan</h5>
                                    <div class="price mb-3">
                                        <span class="display-4 fw-bold">$0</span>
                                        <span class="text-muted">/month</span>
                                    </div>
                                    <ul class="list-unstyled">
                                        <li><i class="fas fa-check text-success"></i> 3 images per day</li>
                                        <li><i class="fas fa-check text-success"></i> Auto removal mode</li>
                                        <li><i class="fas fa-check text-success"></i> Basic quality</li>
                                        <li><i class="fas fa-times text-danger"></i> Manual Pro mode</li>
                                        <li><i class="fas fa-times text-danger"></i> Priority processing</li>
                                    </ul>
                                    <button class="btn btn-outline-success w-100" disabled>
                                        Current Plan
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Monthly Plan -->
                        <div class="col-md-4">
                            <div class="card h-100 border-primary border-2 plan-card" onclick="subscribeToPlan('monthly')" style="cursor: pointer;">
                                <div class="card-body text-center p-4">
                                    <div class="plan-icon mb-3">
                                        <i class="fas fa-star fa-3x text-primary"></i>
                                    </div>
                                    <h5>Pro Monthly</h5>
                                    <div class="price mb-3">
                                        <span class="display-4 fw-bold text-primary">$9.99</span>
                                        <span class="text-muted">/month</span>
                                    </div>
                                    <ul class="list-unstyled">
                                        <li><i class="fas fa-check text-success"></i> Unlimited images</li>
                                        <li><i class="fas fa-check text-success"></i> Manual Pro mode</li>
                                        <li><i class="fas fa-check text-success"></i> HD quality</li>
                                        <li><i class="fas fa-check text-success"></i> Priority processing</li>
                                        <li><i class="fas fa-check text-success"></i> Email support</li>
                                    </ul>
                                    <button class="btn btn-primary w-100" onclick="subscribeToPlan('monthly')">
                                        <i class="fas fa-credit-card"></i> Subscribe Monthly
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Yearly Plan -->
                        <div class="col-md-4">
                            <div class="card h-100 border-warning border-2 position-relative plan-card" onclick="subscribeToPlan('yearly')" style="cursor: pointer;">
                                <div class="position-absolute top-0 start-50 translate-middle">
                                    <span class="badge bg-warning text-dark px-3 py-2">BEST VALUE</span>
                                </div>
                                <div class="card-body text-center p-4 pt-5">
                                    <div class="plan-icon mb-3">
                                        <i class="fas fa-crown fa-3x text-warning"></i>
                                    </div>
                                    <h5>Pro Yearly</h5>
                                    <div class="price mb-3">
                                        <span class="display-4 fw-bold text-warning">$99.99</span>
                                        <span class="text-muted">/year</span>
                                    </div>
                                    <div class="text-success mb-2">
                                        <small><strong>Save 17% ($20/year)</strong></small>
                                    </div>
                                    <ul class="list-unstyled">
                                        <li><i class="fas fa-check text-success"></i> Everything in Monthly</li>
                                        <li><i class="fas fa-check text-success"></i> Batch processing</li>
                                        <li><i class="fas fa-check text-success"></i> API access</li>
                                        <li><i class="fas fa-check text-success"></i> Priority support</li>
                                        <li><i class="fas fa-check text-success"></i> Early features</li>
                                    </ul>
                                    <button class="btn btn-warning w-100" onclick="subscribeToPlan('yearly')">
                                        <i class="fas fa-crown"></i> Subscribe Yearly
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center mt-4">
                        <p class="text-muted mb-2">
                            <i class="fas fa-shield-alt text-success"></i> Secure payment powered by Stripe
                        </p>
                        <p class="text-muted">
                            <i class="fas fa-sync-alt"></i> Cancel anytime
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="modal fade" id="profileModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title">
                        <i class="fas fa-user text-primary"></i> Profile Settings
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="text-center mb-4">
                        <div class="profile-avatar mb-3">
                            <i class="fas fa-user-circle fa-4x text-primary"></i>
                        </div>
                        <h4 id="profileName">User Name</h4>
                        <p class="text-muted" id="profileEmail">user@example.com</p>
                    </div>
                    
                    <div class="row g-3 mb-4">
                        <div class="col-6">
                            <div class="card text-center">
                                <div class="card-body">
                                    <i class="fas fa-images fa-2x text-primary mb-2"></i>
                                    <h5 id="processedCount">0</h5>
                                    <small class="text-muted">Images Processed</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card text-center">
                                <div class="card-body">
                                    <i class="fas fa-calendar fa-2x text-success mb-2"></i>
                                    <h5 id="memberSince">Jan 2025</h5>
                                    <small class="text-muted">Member Since</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="subscription-info p-3 bg-light rounded mb-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong id="currentPlan">Free Plan</strong>
                                <p class="mb-0 text-muted" id="planDetails">3 images per day</p>
                            </div>
                            <button class="btn btn-outline-primary btn-sm" onclick="showSubscription()">
                                <i class="fas fa-arrow-up"></i> Upgrade
                            </button>
                        </div>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button class="btn btn-danger" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i> Sign Out
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 9999;">
        <div id="successToast" class="toast align-items-center text-white bg-success border-0" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body d-flex align-items-center">
                    <i class="fas fa-check-circle me-2"></i>
                    <span id="successToastText"></span>
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
        
        <div id="errorToast" class="toast align-items-center text-white bg-danger border-0" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body d-flex align-items-center">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    <span id="errorToastText"></span>
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
        
        <div id="infoToast" class="toast align-items-center text-white bg-primary border-0" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body d-flex align-items-center">
                    <i class="fas fa-info-circle me-2"></i>
                    <span id="infoToastText"></span>
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
        
        <div id="warningToast" class="toast align-items-center text-dark bg-warning border-0" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body d-flex align-items-center">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <span id="warningToastText"></span>
                </div>
                <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
    </div>

    <!-- Stripe Script -->
    <script src="https://js.stripe.com/v3/"></script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Firebase and JavaScript -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { getFunctions, httpsCallable } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-functions.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, updateProfile } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, updateDoc, increment } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDoPA_WaSKW18QGvCnNNvXpL_G_kRtk46U",
            authDomain: "ai-watermark-backend-2024.firebaseapp.com",
            projectId: "ai-watermark-backend-2024",
            storageBucket: "ai-watermark-backend-2024.firebasestorage.app",
            messagingSenderId: "550066139623",
            appId: "1:550066139623:web:fa14b1be84dbe8a39f4d42"
        };

        const app = initializeApp(firebaseConfig);
        const functions = getFunctions(app);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        // Initialize Stripe (публичный тестовый ключ)
        const stripe = Stripe('pk_test_51QdYfcRuNKvbnBhPrFjXpq3k8vQe7gKKjQ3yS8kE4mEKvC5Wm7zz0Zh8rE6eJ4i4S5rT6y9uI0pQ1wE2rT3yU004Z5Y6bZ');

        // Global variables
        let originalImageData = null;
        let currentMode = 'auto';
        let canvas, ctx;
        let isDrawing = false;
        let brushSize = 20;
        let strokes = [];
        let currentUser = null;
        let userSubscription = null;
        let userTokens = 3; // Начальное количество токенов для фри плана

        // DOM elements
        const fileInput = document.getElementById('fileInput');
        const uploadContainer = document.querySelector('.upload-container');
        const loadingSection = document.getElementById('loadingSection');
        const errorMessage = document.getElementById('errorMessage');
        const successMessage = document.getElementById('successMessage');
        const resultSection = document.getElementById('resultSection');
        const originalImage = document.getElementById('originalImage');
        const processedImage = document.getElementById('processedImage');
        const downloadBtn = document.getElementById('downloadBtn');

        // File upload handling
        fileInput.addEventListener('change', handleFileUpload);

        // Drag and drop functionality
        uploadContainer.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadContainer.classList.add('dragover');
        });

        uploadContainer.addEventListener('dragleave', () => {
            uploadContainer.classList.remove('dragover');
        });

        uploadContainer.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadContainer.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                handleFileUpload({ target: { files } });
            }
        });

        // Handle file upload
        async function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Validate file type
            const validTypes = ['image/png', 'image/jpeg', 'image/webp', 'image/bmp'];
            if (!validTypes.includes(file.type)) {
                showError('Please upload an image in PNG, JPEG, WEBP, or BMP format.');
                return;
            }

            // Validate file size (20MB limit to match original)
            if (file.size > 20 * 1024 * 1024) {
                showError('File size must be less than 20MB.');
                return;
            }

            // Convert to base64
            const reader = new FileReader();
            reader.onload = async (e) => {
                const dataUrl = e.target.result;
                originalImageData = dataUrl;
                const base64Data = dataUrl.split(',')[1];
                
                if (currentMode === 'manual') {
                    // Show manual editor
                    document.getElementById('manualEditor').classList.add('active');
                    initializeCanvas(dataUrl);
                    strokes = [];
                    hideError();
                    hideSuccess();
                } else {
                    // Process with auto mode
                    showLoading(true);
                    hideError();
                    hideSuccess();
                    hideResult();
                    await processWithAI(base64Data, file.type);
                }
            };
            reader.readAsDataURL(file);
        }

        // Process with AI
        async function processWithAI(base64Data, mimeType) {
            // Check if user is logged in
            if (!currentUser) {
                showError('Please log in to process images.');
                showLogin();
                return;
            }

            // Проверяем токены для free пользователей
            if (userSubscription === 'free') {
                if (userTokens <= 0) {
                    showError('🪙 No tokens remaining! Upgrade to Pro for unlimited processing or wait for daily token refresh.');
                    showSubscription();
                    return;
                }
                
                // Показываем оставшиеся токены
                showInfo(`🪙 Using 1 token. You have ${userTokens - 1} tokens remaining after this.`);
            }

            try {
                const removeWatermarkCallable = httpsCallable(functions, 'removeWatermarkWithAI');
                const response = await removeWatermarkCallable({
                    parts: [
                        { inlineData: { data: base64Data, mimeType: mimeType } },
                        { text: 'Remove all watermarks, logos, text overlays, watermark patterns, and unwanted elements from this image. Reconstruct the background naturally while maintaining high image quality. Focus on completely eliminating any visible watermarks.' }
                    ]
                });

                const { data, mimeType: resultMimeType, remainingCredits } = response.data;
                const resultImageUrl = `data:${resultMimeType};base64,${data}`;
                
                showResult(originalImageData, resultImageUrl);
                
                // Обновляем счетчики пользователя
                if (currentUser) {
                    // Списываем токен для free пользователей
                    if (userSubscription === 'free') {
                        userTokens -= 1;
                        // Обновляем в Firestore
                        updateDoc(doc(db, 'users', currentUser.uid), {
                            tokens: userTokens,
                            processedCount: increment(1)
                        }).catch(err => console.error('Error updating tokens:', err));
                    }
                    
                    // Обновляем отображение токенов
                    updateTokenDisplay();
                    
                    // Перезагружаем данные пользователя
                    setTimeout(() => loadUserData(currentUser.uid), 1000);
                }
                
                // Show remaining credits if available
                if (remainingCredits !== undefined && remainingCredits >= 0) {
                    showSuccess(`Watermark removed successfully! You have ${remainingCredits} free attempts remaining.`);
                } else {
                    showSuccess('✨ Watermark removed successfully!');
                }
                
            } catch (error) {
                console.error('Processing error:', error);
                let message = 'Failed to process the image. Please try again.';
                
                if (error.code === 'functions/permission-denied') {
                    message = '⚠️ You have used all your free attempts today. Please try again tomorrow or upgrade to Pro!';
                } else if (error.message && error.message.includes('AI не смог')) {
                    message = 'The AI could not process this image. Please try with a different image that has clear watermarks.';
                } else if (error.message && error.message.includes('не смог')) {
                    message = 'The AI could not create processed image. Please try another image.';
                } else if (error.message) {
                    message = error.message;
                }
                
                showError(message);
            } finally {
                showLoading(false);
            }
        }

        // Show loading state
        function showLoading(show) {
            loadingSection.style.display = show ? 'block' : 'none';
            uploadContainer.style.display = show ? 'none' : 'block';
        }

        // Toast функции
        function showToast(type, message) {
            const toastElement = document.getElementById(type + 'Toast');
            const toastTextElement = document.getElementById(type + 'ToastText');
            
            toastTextElement.textContent = message;
            const toast = new bootstrap.Toast(toastElement, {
                autohide: true,
                delay: 5000
            });
            toast.show();
        }
        
        function showError(message) {
            // Улучшаем сообщения об ошибках
            let improvedMessage = message;
            if (message.includes('auth/email-already-in-use')) {
                improvedMessage = '📧 This email is already registered. Please use Sign In instead.';
            } else if (message.includes('auth/weak-password')) {
                improvedMessage = '🔒 Password is too weak. Please use at least 6 characters.';
            } else if (message.includes('auth/invalid-email')) {
                improvedMessage = '📧 Please enter a valid email address.';
            } else if (message.includes('auth/user-not-found')) {
                improvedMessage = '❌ No account found with this email. Please sign up first.';
            } else if (message.includes('auth/wrong-password')) {
                improvedMessage = '🔑 Incorrect password. Please try again.';
            } else if (message.includes('auth/invalid-credential')) {
                improvedMessage = '🔐 Invalid login credentials. Please check your email and password.';
            }
            
            showToast('error', improvedMessage);
            
            // Оставляем старый метод для совместимости
            if (errorMessage) {
                errorMessage.textContent = improvedMessage;
                errorMessage.style.display = 'block';
                errorMessage.classList.add('fade-in');
            }
        }

        // Hide error message
        function hideError() {
            if (errorMessage) {
                errorMessage.style.display = 'none';
            }
        }

        // Show success message
        function showSuccess(message) {
            showToast('success', message);
            
            // Оставляем старый метод для совместимости
            if (successMessage) {
                successMessage.textContent = message;
                successMessage.style.display = 'block';
                successMessage.classList.add('fade-in');
            }
        }

        // Hide success message
        function hideSuccess() {
            if (successMessage) {
                successMessage.style.display = 'none';
            }
        }
        
        // Дополнительные функции для разных типов уведомлений
        function showInfo(message) {
            showToast('info', message);
        }
        
        function showWarning(message) {
            showToast('warning', message);
        }

        // Show result
        function showResult(originalUrl, resultUrl) {
            originalImage.src = originalUrl;
            processedImage.src = resultUrl;
            resultSection.style.display = 'block';
            resultSection.classList.add('fade-in');
            
            // Setup download functionality
            downloadBtn.onclick = function() {
                const link = document.createElement('a');
                link.href = resultUrl;
                link.download = 'watermark-removed.png';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };
            
            // Setup main share functionality
            document.getElementById('mainShareBtn').onclick = function() {
                if (navigator.share) {
                    navigator.share({
                        title: 'AI Watermark Removed Image',
                        text: 'Check out my image processed with AI watermark remover!',
                        url: window.location.href
                    });
                } else {
                    navigator.clipboard.writeText(window.location.href).then(() => {
                        showSuccess('🔗 Link copied to clipboard! Share with your friends.');
                    });
                    
                    // Auto download for sharing
                    const link = document.createElement('a');
                    link.href = resultUrl;
                    link.download = 'ai-processed-image.png';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
            };
            
            // Scroll to result
            resultSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Hide result
        function hideResult() {
            resultSection.style.display = 'none';
        }

        // Reset upload (global function)
        window.resetUpload = function() {
            fileInput.value = '';
            hideResult();
            hideError();
            hideSuccess();
            showLoading(false);
            originalImageData = null;
            
            // Scroll back to upload
            document.getElementById('app-playground').scrollIntoView({ behavior: 'smooth' });
        };

        // Before/After Slider Functionality
        function initializeSlider(sliderId, handleId) {
            const slider = document.getElementById(sliderId);
            const handle = document.getElementById(handleId);
            if (!slider || !handle) return;
            
            const afterImage = slider.querySelector('.after-image-container');
            let isDragging = false;
            
            function updateSlider(x) {
                const rect = slider.getBoundingClientRect();
                const percentage = Math.max(0, Math.min(100, ((x - rect.left) / rect.width) * 100));
                
                handle.style.left = percentage + '%';
                afterImage.style.clipPath = `inset(0 ${100 - percentage}% 0 0)`;
            }
            
            // Mouse events
            handle.addEventListener('mousedown', (e) => {
                isDragging = true;
                e.preventDefault();
            });
            
            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    updateSlider(e.clientX);
                }
            });
            
            document.addEventListener('mouseup', () => {
                isDragging = false;
            });
            
            // Touch events for mobile
            handle.addEventListener('touchstart', (e) => {
                isDragging = true;
                e.preventDefault();
            });
            
            document.addEventListener('touchmove', (e) => {
                if (isDragging) {
                    const touch = e.touches[0];
                    updateSlider(touch.clientX);
                }
            });
            
            document.addEventListener('touchend', () => {
                isDragging = false;
            });
            
            // Click to position
            slider.addEventListener('click', (e) => {
                if (e.target !== handle && !handle.contains(e.target)) {
                    updateSlider(e.clientX);
                }
            });
        }
        

        // Initialize Manual Editor Canvas
        function initializeCanvas(imageUrl) {
            canvas = document.getElementById('editingCanvas');
            ctx = canvas.getContext('2d');
            
            const img = new Image();
            img.onload = function() {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                
                // Set canvas style - увеличиваем минимум в 2 раза
                const minDisplayWidth = Math.max(600, img.width);
                const maxDisplayWidth = Math.min(1200, window.innerWidth * 0.9);
                const displayWidth = Math.min(minDisplayWidth * 2, maxDisplayWidth);
                
                const scale = displayWidth / img.width;
                canvas.style.width = displayWidth + 'px';
                canvas.style.height = (img.height * scale) + 'px';
                
                // Reset drawing state
                strokes = [];
                ctx.globalCompositeOperation = 'source-over';
            };
            img.src = imageUrl;
        }

        // Canvas Drawing Functions
        function startDrawing(e) {
            if (currentMode !== 'manual') return;
            isDrawing = true;
            draw(e);
        }

        function draw(e) {
            if (!isDrawing || currentMode !== 'manual') return;
            
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;
            
            const x = (e.clientX - rect.left) * scaleX;
            const y = (e.clientY - rect.top) * scaleY;
            
            // Сплошная заливка кистью
            ctx.globalCompositeOperation = 'source-over';
            ctx.fillStyle = 'rgba(255, 0, 0, 0.6)';
            
            // Если есть предыдущая точка, рисуем линию для сплошности
            if (strokes.length > 0) {
                const lastStroke = strokes[strokes.length - 1];
                const distance = Math.sqrt(Math.pow(x - lastStroke.x, 2) + Math.pow(y - lastStroke.y, 2));
                
                if (distance > 1) {
                    // Рисуем линию между точками для сплошности
                    const steps = Math.ceil(distance / (brushSize / 4));
                    for (let i = 0; i <= steps; i++) {
                        const t = i / steps;
                        const interpolatedX = lastStroke.x + (x - lastStroke.x) * t;
                        const interpolatedY = lastStroke.y + (y - lastStroke.y) * t;
                        
                        ctx.beginPath();
                        ctx.arc(interpolatedX, interpolatedY, brushSize, 0, 2 * Math.PI);
                        ctx.fill();
                    }
                }
            }
            
            // Рисуем текущую точку
            ctx.beginPath();
            ctx.arc(x, y, brushSize, 0, 2 * Math.PI);
            ctx.fill();
            
            strokes.push({x, y, size: brushSize});
        }

        function stopDrawing() {
            isDrawing = false;
        }

        // Brush Size Control
        function updateBrushSize() {
            const brushSizeInput = document.getElementById('brushSize');
            const brushDisplay = document.getElementById('brushDisplay');
            brushSize = parseInt(brushSizeInput.value);
            brushDisplay.style.width = Math.min(50, brushSize) + 'px';
            brushDisplay.style.height = Math.min(50, brushSize) + 'px';
        }

        // Manual Editor Controls
        function initializeManualControls() {
            // Brush size control
            document.getElementById('brushSize').addEventListener('input', updateBrushSize);
            
            // Canvas events
            const editingCanvas = document.getElementById('editingCanvas');
            editingCanvas.addEventListener('mousedown', startDrawing);
            editingCanvas.addEventListener('mousemove', draw);
            editingCanvas.addEventListener('mouseup', stopDrawing);
            editingCanvas.addEventListener('mouseout', stopDrawing);
            
            // Touch events
            editingCanvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent('mousedown', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                editingCanvas.dispatchEvent(mouseEvent);
            });
            
            editingCanvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent('mousemove', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                editingCanvas.dispatchEvent(mouseEvent);
            });
            
            editingCanvas.addEventListener('touchend', (e) => {
                e.preventDefault();
                const mouseEvent = new MouseEvent('mouseup', {});
                editingCanvas.dispatchEvent(mouseEvent);
            });
            
            // Control buttons
            document.getElementById('clearBtn').onclick = () => {
                if (originalImageData) {
                    initializeCanvas(originalImageData);
                    strokes = [];
                }
            };
            
            document.getElementById('newImageBtn').onclick = () => {
                // Очищаем предыдущие данные
                originalImageData = null;
                strokes = [];
                
                // Очищаем canvas
                if (canvas && ctx) {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                }
                
                // Скрываем результаты
                document.getElementById('manualResult').style.display = 'none';
                document.getElementById('manualLoading').style.display = 'none';
                document.getElementById('instructionText').style.display = 'block';
                
                // Открываем диалог выбора файла
                document.getElementById('fileInput').click();
            };
            
            document.getElementById('processManualBtn').onclick = processManualSelection;
        }

        // Process Manual Selection
        async function processManualSelection() {
            // Проверяем, есть ли отмеченные области

            if (strokes.length === 0) {
                showError('Please mark areas to remove with the brush tool first.');
                return;
            }
            
            // Показать loading в Manual Editor
            document.getElementById('manualLoading').style.display = 'block';
            document.getElementById('instructionText').style.display = 'none';
            hideError();
            hideSuccess();
            
            try {
                // Create mask from strokes with better quality
                const maskCanvas = document.createElement('canvas');
                maskCanvas.width = canvas.width;
                maskCanvas.height = canvas.height;
                const maskCtx = maskCanvas.getContext('2d');
                
                maskCtx.fillStyle = 'white';
                maskCtx.fillRect(0, 0, maskCanvas.width, maskCanvas.height);
                maskCtx.fillStyle = 'black';
                
                // Создаем сплошную маску
                for (let i = 0; i < strokes.length; i++) {
                    const stroke = strokes[i];
                    maskCtx.beginPath();
                    maskCtx.arc(stroke.x, stroke.y, stroke.size, 0, 2 * Math.PI);
                    maskCtx.fill();
                    
                    // Соединяем с предыдущей точкой
                    if (i > 0) {
                        const prevStroke = strokes[i - 1];
                        const distance = Math.sqrt(Math.pow(stroke.x - prevStroke.x, 2) + Math.pow(stroke.y - prevStroke.y, 2));
                        if (distance < 50) {
                            maskCtx.lineWidth = stroke.size * 2;
                            maskCtx.beginPath();
                            maskCtx.moveTo(prevStroke.x, prevStroke.y);
                            maskCtx.lineTo(stroke.x, stroke.y);
                            maskCtx.stroke();
                        }
                    }
                }
                
                // Get original image data without red overlay
                const originalCanvas = document.createElement('canvas');
                originalCanvas.width = canvas.width;
                originalCanvas.height = canvas.height;
                const originalCtx = originalCanvas.getContext('2d');
                const img = new Image();
                img.onload = async function() {
                    originalCtx.drawImage(img, 0, 0);
                    
                    const imageData = originalCanvas.toDataURL().split(',')[1];
                    const maskData = maskCanvas.toDataURL().split(',')[1];
                    
                    const removeWatermarkCallable = httpsCallable(functions, 'removeWatermarkWithAI');
                    const response = await removeWatermarkCallable({
                        parts: [
                            { inlineData: { data: imageData, mimeType: 'image/png' } },
                            { inlineData: { data: maskData, mimeType: 'image/png' } },
                            { text: 'Remove the areas marked in black on the mask image. Reconstruct the background naturally while maintaining high image quality. Focus on completely eliminating any visible watermarks in the marked areas.' }
                        ]
                    });
                    
                    const { data, mimeType: resultMimeType, remainingCredits } = response.data;
                    const resultImageUrl = `data:${resultMimeType};base64,${data}`;
                    
                    // Показать результат в Manual Editor
                    showManualResult(originalImageData, resultImageUrl);
                    
                    // Update user's processed count and reload data
                    if (currentUser) {
                        loadUserData(currentUser.uid);
                    }
                    
                    if (remainingCredits !== undefined && remainingCredits >= 0) {
                        showSuccess(`✨ Manual editing completed successfully! You have ${remainingCredits} free attempts remaining.`);
                    } else {
                        showSuccess('✨ Manual editing completed successfully!');
                    }
                    
                    document.getElementById('manualLoading').style.display = 'none';
                };
                img.src = originalImageData;
                
            } catch (error) {
                console.error('Manual processing error:', error);
                let message = 'Failed to process the marked areas. Please try again with different selections.';
                
                if (error.code === 'functions/permission-denied') {
                    message = '⚠️ You have used all your free attempts today. Please try again tomorrow or upgrade to Pro!';
                } else if (error.message && error.message.includes('AI не смог')) {
                    message = 'The AI could not process the selected areas. Please try marking different areas or use Auto mode for this image.';
                } else if (error.message) {
                    message = error.message;
                }
                
                showError(message);
                document.getElementById('manualLoading').style.display = 'none';
                document.getElementById('instructionText').style.display = 'block';
            }
        }

        // FAQ Functionality
        function initializeFAQ() {
            document.querySelectorAll('.faq-question').forEach(button => {
                button.addEventListener('click', () => {
                    const faqItem = button.parentElement;
                    const isActive = faqItem.classList.contains('active');
                    
                    // Close all other FAQ items
                    document.querySelectorAll('.faq-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    
                    // Toggle current item
                    if (!isActive) {
                        faqItem.classList.add('active');
                    }
                });
            });
        }

        // Show Manual Editor Result
        function showManualResult(originalUrl, resultUrl) {
            document.getElementById('manualOriginalImage').src = originalUrl;
            document.getElementById('manualProcessedImage').src = resultUrl;
            document.getElementById('manualResult').style.display = 'block';
            document.getElementById('manualResult').classList.add('fade-in');
            
            // Setup manual download functionality
            document.getElementById('manualDownloadBtn').onclick = function() {
                const link = document.createElement('a');
                link.href = resultUrl;
                link.download = 'manual-watermark-removed.png';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };
            
            // Setup share functionality
            document.getElementById('shareBtn').onclick = function() {
                if (navigator.share) {
                    // Мобильный share API
                    navigator.share({
                        title: 'AI Watermark Removed Image',
                        text: 'Check out my professionally edited image!',
                        url: window.location.href
                    });
                } else {
                    // Desktop - copy to clipboard and show notification
                    navigator.clipboard.writeText(window.location.href).then(() => {
                        showSuccess('🔗 Link copied to clipboard! Share with your friends.');
                    });
                    
                    // Auto download for sharing
                    const link = document.createElement('a');
                    link.href = resultUrl;
                    link.download = 'manual-edited-image.png';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
            };
            
            // Scroll to result
            document.getElementById('manualResult').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Reset Manual Editor
        window.resetManualEditor = function() {
            document.getElementById('manualEditor').classList.remove('active');
            document.getElementById('manualResult').style.display = 'none';
            document.getElementById('manualLoading').style.display = 'none';
            document.getElementById('instructionText').style.display = 'block';
            document.getElementById('fileInput').value = '';
            hideError();
            hideSuccess();
            originalImageData = null;
            strokes = [];
            
            // Reset to auto mode
            currentMode = 'auto';
            document.querySelectorAll('.mode-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById('autoMode').classList.add('active');
            document.getElementById('uploadText').textContent = 'For more precise results, use edit mode.';
        };

        // Глобальные функции для модальных окон
        window.showLogin = function() {
            try {
                const modal = new bootstrap.Modal(document.getElementById('loginModal'));
                modal.show();
            } catch (error) {
                console.error('Error showing login modal:', error);
            }
        };

        window.showRegister = function() {
            try {
                const modal = new bootstrap.Modal(document.getElementById('registerModal'));
                modal.show();
            } catch (error) {
                console.error('Error showing register modal:', error);
            }
        };

        window.showSubscription = function() {
            // Закрыть все открытые модальные окна перед открытием subscription modal
            const openModals = document.querySelectorAll('.modal.show');
            openModals.forEach(modal => {
                const instance = bootstrap.Modal.getInstance(modal);
                if (instance) {
                    instance.hide();
                }
            });
            
            // Небольшая задержка перед открытием нового модального окна
            setTimeout(() => {
                const modal = new bootstrap.Modal(document.getElementById('subscriptionModal'));
                modal.show();
            }, 150);
        };

        window.showProfile = function() {
            const modal = new bootstrap.Modal(document.getElementById('profileModal'));
            modal.show();
        };

        window.switchToRegister = function() {
            const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
            if (loginModal) loginModal.hide();
            setTimeout(() => window.showRegister(), 150);
        };

        window.switchToLogin = function() {
            const registerModal = bootstrap.Modal.getInstance(document.getElementById('registerModal'));
            if (registerModal) registerModal.hide();
            setTimeout(() => window.showLogin(), 150);
        };


        // Google Sign In/Up
        window.signInWithGoogle = async function() {
            try {
                showInfo('🔄 Signing in with Google...');
                const provider = new GoogleAuthProvider();
                
                
                const result = await signInWithPopup(auth, provider);
                
                const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
                if (loginModal) loginModal.hide();
                
                showSuccess('✅ Successfully logged in with Google!');
                updateUserInterface(result.user);
            } catch (error) {
                console.error('Google sign-in error:', error);
                if (error.code === 'auth/popup-closed-by-user') {
                    showWarning('🚫 Sign-in was canceled. Please try again.');
                } else if (error.code === 'auth/popup-blocked') {
                    showError('🚫 Popup was blocked. Please allow popups for this site.');
                } else {
                    showError('Google sign-in failed: ' + error.message);
                }
            }
        };

        window.signUpWithGoogle = async function() {
            try {
                showInfo('🔄 Creating account with Google...');
                const provider = new GoogleAuthProvider();
                
                
                const result = await signInWithPopup(auth, provider);
                
                // Проверяем, существует ли документ пользователя
                const userDoc = await getDoc(doc(db, 'users', result.user.uid));
                if (!userDoc.exists()) {
                    // Создаем документ пользователя для новых Google пользователей
                    await setDoc(doc(db, 'users', result.user.uid), {
                        name: result.user.displayName || 'Google User',
                        email: result.user.email,
                        createdAt: new Date(),
                        subscription: 'free',
                        processedCount: 0,
                        tokens: 3 // Начальные токены для новых Google пользователей
                    });
                    showSuccess('🎉 New account created with Google!');
                } else {
                    showSuccess('✅ Welcome back!');
                }

                const registerModal = bootstrap.Modal.getInstance(document.getElementById('registerModal'));
                if (registerModal) registerModal.hide();
                
                updateUserInterface(result.user);
            } catch (error) {
                console.error('Google sign-up error:', error);
                if (error.code === 'auth/popup-closed-by-user') {
                    showWarning('🚫 Sign-up was canceled. Please try again.');
                } else if (error.code === 'auth/popup-blocked') {
                    showError('🚫 Popup was blocked. Please allow popups for this site.');
                } else {
                    showError('Google sign-up failed: ' + error.message);
                }
            }
        };

        // Logout
        window.logout = async function() {
            try {
                await signOut(auth);
                showSuccess('👋 Successfully logged out!');
                updateUserInterface(null);
            } catch (error) {
                showError('Logout failed: ' + error.message);
            }
        };

        // Subscribe to Plan with Stripe
        window.subscribeToPlan = async function(planType) {
            if (!currentUser) {
                showError('Please log in first to subscribe.');
                showLogin();
                return;
            }

            showInfo('🔄 Setting up payment...');
            
            try {
                // Создаем сессию оплаты через Firebase Functions
                const createCheckoutSession = httpsCallable(functions, 'createCheckoutSession');
                const response = await createCheckoutSession({
                    plan: planType === 'monthly' ? 'pro_monthly' : 'pro_yearly'
                });

                if (response.data && response.data.url) {
                    // Перенаправляем на Stripe Checkout
                    window.location.href = response.data.url;
                } else {
                    throw new Error('Не удалось получить URL оплаты');
                }
            } catch (error) {
                console.error('Payment error:', error);
                showError('Фака оплаты временно недоступна. Пожалуйста, попробуйте позже.');
            }
        };

        // Update User Interface
        function updateUserInterface(user) {
            currentUser = user;
            
            if (user) {
                // Show user menu, hide auth buttons
                document.getElementById('loginBtn').style.display = 'none';
                document.getElementById('registerBtn').style.display = 'none';
                document.getElementById('userMenu').style.display = 'block';
                document.getElementById('userName').textContent = user.displayName || 'User';
                
                // Update profile modal
                document.getElementById('profileName').textContent = user.displayName || 'User';
                document.getElementById('profileEmail').textContent = user.email;
                
                // Load user subscription data
                loadUserData(user.uid);
            } else {
                // Show auth buttons, hide user menu
                document.getElementById('loginBtn').style.display = 'inline-block';
                document.getElementById('registerBtn').style.display = 'inline-block';
                document.getElementById('userMenu').style.display = 'none';
                userSubscription = null;
            }
        }

        // Функция переключения режимов
        window.selectMode = function(mode) {
            // Обновляем текущий режим
            currentMode = mode;
            
            // Обновляем активную вкладку
            document.querySelectorAll('.mode-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(mode + 'Mode').classList.add('active');
            
            // Обновляем текст загрузки
            const uploadText = document.getElementById('uploadText');
            if (mode === 'auto') {
                uploadText.textContent = 'Upload an image for automatic watermark removal.';
                // Скрываем manual editor если он был активен
                document.getElementById('manualEditor').classList.remove('active');
            } else if (mode === 'manual') {
                uploadText.textContent = 'Upload an image to start Manual Pro editing with brush tool.';
            }
        };
        
        // Обновляем отображение токенов
        function updateTokenDisplay() {
            const tokenElements = {
                userTokens: document.getElementById('userTokens'),
                headerTokenBalance: document.getElementById('headerTokenBalance'),
                headerProcessedCount: document.getElementById('headerProcessedCount'),
                headerSubscriptionStatus: document.getElementById('headerSubscriptionStatus'),
                tokenProgress: document.getElementById('tokenProgress')
            };
            
            if (userSubscription === 'pro') {
                // Для Pro пользователей
                if (tokenElements.userTokens) tokenElements.userTokens.textContent = '✨ Unlimited';
                if (tokenElements.headerTokenBalance) tokenElements.headerTokenBalance.textContent = '∞';
                if (tokenElements.headerSubscriptionStatus) {
                    tokenElements.headerSubscriptionStatus.textContent = 'Pro';
                    tokenElements.headerSubscriptionStatus.className = 'badge bg-warning';
                }
                if (tokenElements.tokenProgress) tokenElements.tokenProgress.style.width = '100%';
            } else {
                // Для Free пользователей
                if (tokenElements.userTokens) tokenElements.userTokens.textContent = `🪙 ${userTokens} tokens`;
                if (tokenElements.headerTokenBalance) tokenElements.headerTokenBalance.textContent = userTokens;
                if (tokenElements.headerSubscriptionStatus) {
                    tokenElements.headerSubscriptionStatus.textContent = 'Free';
                    tokenElements.headerSubscriptionStatus.className = 'badge bg-success';
                }
                if (tokenElements.tokenProgress) {
                    const progressWidth = (userTokens / 3) * 100;
                    tokenElements.tokenProgress.style.width = progressWidth + '%';
                    // Цвет прогресс-бара в зависимости от оставшихся токенов
                    if (userTokens === 0) {
                        tokenElements.tokenProgress.className = 'progress-bar bg-danger';
                    } else if (userTokens === 1) {
                        tokenElements.tokenProgress.className = 'progress-bar bg-warning';
                    } else {
                        tokenElements.tokenProgress.className = 'progress-bar bg-success';
                    }
                }
            }
            
            // Обновляем остальные элементы
            if (currentUser) {
                const nameElements = {
                    dropdownUserName: document.getElementById('dropdownUserName'),
                    dropdownUserEmail: document.getElementById('dropdownUserEmail')
                };
                
                if (nameElements.dropdownUserName) nameElements.dropdownUserName.textContent = currentUser.displayName || 'User';
                if (nameElements.dropdownUserEmail) nameElements.dropdownUserEmail.textContent = currentUser.email;
            }
        }

        // Load User Data from Firestore
        async function loadUserData(uid) {
            try {
                const userDoc = await getDoc(doc(db, 'users', uid));
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    userSubscription = userData.subscription || 'free';
                    userTokens = userData.tokens || 3; // Загружаем токены из базы данных
                    
                    // Обновляем UI с данными пользователя (с проверками)
                    const processedCountElement = document.getElementById('processedCount');
                    if (processedCountElement) processedCountElement.textContent = userData.processedCount || 0;
                    
                    const memberSinceElement = document.getElementById('memberSince');
                    if (memberSinceElement && userData.createdAt) {
                        memberSinceElement.textContent = 
                            new Date(userData.createdAt.toDate()).toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
                    }
                    
                    // Обновляем токены в UI
                    updateTokenDisplay();
                    
                    // Обновляем статус подписки
                    const subscriptionText = userData.subscription === 'pro' ? 'Pro Plan' : 'Free Plan';
                    const subscriptionStatusElement = document.getElementById('subscriptionStatus');
                    if (subscriptionStatusElement) subscriptionStatusElement.textContent = subscriptionText;
                    
                    const currentPlanElement = document.getElementById('currentPlan');
                    if (currentPlanElement) currentPlanElement.textContent = subscriptionText;
                    
                    const planDetails = userData.subscription === 'pro' ? 'Unlimited tokens' : userTokens + ' tokens remaining';
                    const planDetailsElement = document.getElementById('planDetails');
                    if (planDetailsElement) planDetailsElement.textContent = planDetails;
                    
                    // Manual Pro режим доступен всем
                    const manualMode = document.getElementById('manualMode');
                    if (manualMode) {
                        manualMode.style.opacity = '1';
                        manualMode.style.filter = 'none';
                        manualMode.title = 'Manual Pro mode - Precision watermark removal with brush tool';
                    }
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        // Check for successful payment
        function checkPaymentSuccess() {
            const urlParams = new URLSearchParams(window.location.search);
            const sessionId = urlParams.get('session_id');
            const success = urlParams.get('success');
            const canceled = urlParams.get('canceled');
            const plan = urlParams.get('plan');
            
            if (sessionId && success === 'true') {
                const planName = plan === 'yearly' ? 'Yearly' : 'Monthly';
                showSuccess(`🎉 Payment successful! Welcome to Pro ${planName} plan!`);
                
                // Обновляем подписку пользователя (для демо)
                if (currentUser && userSubscription === 'free') {
                    userSubscription = 'pro';
                    
                    // Обновляем UI
                    setTimeout(() => {
                        const subscriptionStatusElement = document.getElementById('subscriptionStatus');
                        if (subscriptionStatusElement) subscriptionStatusElement.textContent = `Pro Plan (${planName})`;
                        
                        const currentPlanElement = document.getElementById('currentPlan');
                        if (currentPlanElement) currentPlanElement.textContent = `Pro Plan (${planName})`;
                        
                        const planDetailsElement = document.getElementById('planDetails');
                        if (planDetailsElement) planDetailsElement.textContent = 'Unlimited images';
                        
                        // Включаем Manual Pro режим
                        const manualMode = document.getElementById('manualMode');
                        if (manualMode) {
                            manualMode.style.opacity = '1';
                            manualMode.onclick = function() { selectMode('manual'); };
                        }
                        
                        showInfo('✨ Manual Pro mode is now available! Try precision watermark removal.');
                    }, 1000);
                }
                
                // Очищаем URL
                window.history.replaceState({}, document.title, window.location.pathname);
                
                // Обновляем данные пользователя
                if (currentUser) {
                    setTimeout(() => loadUserData(currentUser.uid), 2000);
                }
            } else if (canceled === 'true') {
                showWarning('🚫 Payment was canceled. You can try again anytime.');
                // Очищаем URL
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        }

        // Auth State Listener
        onAuthStateChanged(auth, (user) => {
            updateUserInterface(user);
        });

        // Initialize both sliders
        document.addEventListener('DOMContentLoaded', () => {
            initializeSlider('demoSlider', 'demoSliderHandle');
            initializeSlider('advantagesSlider', 'advantagesSliderHandle');
            initializeManualControls();
            initializeFAQ();
            updateBrushSize();
            checkPaymentSuccess();
            
            // Инициализируем обработчики форм авторизации
            initializeAuthHandlers();
        });
        
        // Инициализация обработчиков авторизации
        function initializeAuthHandlers() {
            // Проверяем, что элементы существуют
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            
            if (loginForm && !loginForm.hasAttribute('data-handler-added')) {
                loginForm.setAttribute('data-handler-added', 'true');
                loginForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const email = document.getElementById('loginEmail').value;
                    const password = document.getElementById('loginPassword').value;
                    
                    if (!email || !password) {
                        showError('Please fill in all fields.');
                        return;
                    }

                    try {
                        showInfo('🔄 Signing in...');
                        const userCredential = await signInWithEmailAndPassword(auth, email, password);
                        const loginModal = bootstrap.Modal.getInstance(document.getElementById('loginModal'));
                        if (loginModal) loginModal.hide();
                        showSuccess('✅ Successfully logged in!');
                        updateUserInterface(userCredential.user);
                    } catch (error) {
                        console.error('Login error:', error);
                        showError('Login failed: ' + error.message);
                    }
                });
            }

            if (registerForm && !registerForm.hasAttribute('data-handler-added')) {
                registerForm.setAttribute('data-handler-added', 'true');
                registerForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const name = document.getElementById('registerName').value;
                    const email = document.getElementById('registerEmail').value;
                    const password = document.getElementById('registerPassword').value;
                    const agreeTerms = document.getElementById('agreeTerms').checked;
                    
                    if (!name || !email || !password) {
                        showError('Please fill in all fields.');
                        return;
                    }
                    
                    if (!agreeTerms) {
                        showError('Please agree to the Terms of Service and Privacy Policy.');
                        return;
                    }

                    try {
                        showInfo('🔄 Creating account...');
                        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                        await updateProfile(userCredential.user, { displayName: name });
                        
                        // Create user document in Firestore
                        await setDoc(doc(db, 'users', userCredential.user.uid), {
                            name: name,
                            email: email,
                            createdAt: new Date(),
                            subscription: 'free',
                            processedCount: 0,
                            tokens: 3 // Начальные токены для новых пользователей
                        });

                        const registerModal = bootstrap.Modal.getInstance(document.getElementById('registerModal'));
                        if (registerModal) registerModal.hide();
                        showSuccess('🎉 Account created successfully! Welcome!');
                        updateUserInterface(userCredential.user);
                    } catch (error) {
                        console.error('Registration error:', error);
                        showError('Registration failed: ' + error.message);
                    }
                });
            }
        }

        // Smooth scrolling for navigation links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });
    </script>
</body>
</html>